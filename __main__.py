"""Read website and parse its content."""

import logging
import re
from dataclasses import dataclass
from typing import Self
import pandas as pd
from scrap_villes_a_vivre.parser_page import get_informations_from_url

WEBSITE: str = "https://www.villesavivre.fr/"


@dataclass
class TownInformations:
    """Informations about a particular town."""

    url_suffix: str

    @property
    def url(self: Self) -> str:
        """Return url for this town."""
        return WEBSITE + self.url_suffix


def get_informations_from_list(
    informations: list[str], information_regex: str
) -> tuple[str]:
    """Return bac+5 for results."""
    r: re.Pattern = re.compile(information_regex)
    result: tuple[str] = ()
    for data in informations:
        match: re.Match
        if match := r.match(data):
            result += (str(match.group("result")),)

    if result:
        return result
    return ("Not found!",)


if __name__ == "__main__":
    villes: set[str] = {
        "versailles-78646",
        "antony-92002",
        "asnieres-sur-seine-92004",
        "cergy-95127",
        "bagneux-92007",
        # "bois-colombes-92009",
        # "boulogne-billancourt-92012",
        # "bourg-la-reine-92014",
        # "chatenay-malabry-92019",
        # "chatillon-92020",
        # "chaville-92022",
        # "clamart-92023",
        # "clichy-92024",
        # "colombes-92025",
        # "courbevoie-92026",
        # "fontenay-aux-roses-92032",
        # "garches-92033",
        # "gennevilliers-92036",
        # "issy-les-moulineaux-92040",
        # "la-garenne-colombes-92035",
        # "le-plessis-robinson-92060",
        # "levallois-perret-92044",
        # "malakoff-92046",
        # "marnes-la-coquette-92047",
        # "meudon-92048",
        # "montrouge-92049",
        # "nanterre-92050",
        # "neuilly-sur-seine-92051",
        # "puteaux-92062",
        # "rueil-malmaison-92063",
        # "saint-cloud-92064",
        # "sceaux-92071",
        # "sevres-92072",
        # "suresnes-92073",
        # "vanves-92075",
        # "vaucresson-92076",
        # "ville-d-avray-92077",
        # "villeneuve-la-garenne-92078",
        # "ablis-78003",
        # "acheres-78005",
        # "adainville-78006",
        # "aigremont-78007",
        # "allainville-78009",
        # "andelu-78013",
        # "andresy-78015",
        # "arnouville-les-mantes-78020",
        # "aubergenville-78029",
        # "auffargis-78030",
        # "auffreville-brasseuil-78031",
        # "aulnay-sur-mauldre-78033",
        # "auteuil-78034",
        # "autouillet-78036",
        # "bailly-78043",
        # "bazainville-78048",
        # "bazemont-78049",
        # "bazoches-sur-guyonne-78050",
        # "behoust-78053",
        # "bennecourt-78057",
        # "beynes-78062",
        # "blaru-78068",
        # "boinville-en-mantois-78070",
        # "boinville-le-gaillard-78071",
        # "boinvilliers-78072",
        # "bois-d-arcy-78073",
        # "boissets-78076",
        # "boissy-mauvoisin-78082",
        # "boissy-sans-avoir-78084",
        # "bonnelles-78087",
        # "bonnieres-sur-seine-78089",
        # "bouafle-78090",
        # "bougival-78092",
        # "bourdonne-78096",
        # "breuil-bois-robert-78104",
        # "breval-78107",
        # "brueil-en-vexin-78113",
        # "buc-78117",
        # "buchelay-78118",
        # "bullion-78120",
        # "carrieres-sous-poissy-78123",
        # "carrieres-sur-seine-78124",
        # "cernay-la-ville-78128",
        # "chambourcy-78133",
        # "chanteloup-les-vignes-78138",
        # "chapet-78140",
        # "chateaufort-78143",
        # "chatou-78146",
        # "chaufour-les-bonnieres-78147",
        # "chavenay-78152",
        # "chevreuse-78160",
        # "choisel-78162",
        # "civry-la-foret-78163",
        # "clairefontaine-en-yvelines-78164",
        # "coignieres-78168",
        # "conde-sur-vesgre-78171",
        # "conflans-sainte-honorine-78172",
        # "courgent-78185",
        # "cravent-78188",
        # "crespieres-78189",
        # "croissy-sur-seine-78190",
        # "dammartin-en-serve-78192",
        # "dampierre-en-yvelines-78193",
        # "dannemarie-78194",
        # "davron-78196",
        # "drocourt-78202",
        # "ecquevilly-78206",
        # "elancourt-78208",
        # "emance-78209",
        # "epone-78217",
        # "evecquemont-78227",
        # "favrieux-78231",
        # "feucherolles-78233",
        # "flacourt-78234",
        # "flexanville-78236",
        # "flins-neuve-eglise-78237",
        # "flins-sur-seine-78238",
        # "follainville-dennemont-78239",
        # "fontenay-le-fleury-78242",
        # "fontenay-mauvoisin-78245",
        # "fontenay-saint-pere-78246",
        # "freneuse-78255",
        # "gaillon-sur-montcient-78261",
        # "galluis-78262",
        # "gambais-78263",
        # "gambaiseuil-78264",
        # "garancieres-78265",
        # "gargenville-78267",
        # "gazeran-78269",
        # "gommecourt-78276",
        # "goupillieres-78278",
        # "goussonville-78281",
        # "grandchamp-78283",
        # "gressey-78285",
        # "grosrouvre-78289",
        # "guernes-78290",
        # "guerville-78291",
        # "guitrancourt-78296",
        # "guyancourt-78297",
        # "hardricourt-78299",
        # "hargeville-78300",
        # "herbeville-78305",
        # "hermeray-78307",
        # "houdan-78310",
        # "houilles-78311",
        # "issou-78314",
        # "jambville-78317",
        # "jouars-pontchartrain-78321",
        # "jouy-en-josas-78322",
        # "jouy-mauvoisin-78324",
        # "jumeauville-78325",
        # "juziers-78327",
        # "l-etang-la-ville-78224",
        # "la-boissiere-ecole-78077",
        # "la-celle-les-bordes-78125",
        # "la-celle-saint-cloud-78126",
        # "la-falaise-78230",
        # "la-hauteville-78302",
        # "la-queue-les-yvelines-78513",
        # "la-verriere-78644",
        # "la-villeneuve-en-chevrie-78668",
        # "lainville-en-vexin-78329",
        # "le-chesnay-rocquencourt-78158",
        # "le-mesnil-le-roi-78396",
        # "le-mesnil-saint-denis-78397",
        # "le-pecq-78481",
        # "le-perray-en-yvelines-78486",
        # "le-port-marly-78502",
        # "le-tartre-gaudran-78606",
        # "le-tertre-saint-denis-78608",
        # "le-tremblay-sur-mauldre-78623",
        # "le-vesinet-78650",
        # "les-alluets-le-roi-78010",
        # "les-breviaires-78108",
        # "les-clayes-sous-bois-78165",
        # "les-essarts-le-roi-78220",
        # "les-loges-en-josas-78343",
        # "les-mesnuls-78398",
        # "les-mureaux-78440",
        # "levis-saint-nom-78334",
        # "limay-78335",
        # "limetz-villez-78337",
        # "lommoye-78344",
        # "longnes-78346",
        # "longvilliers-78349",
        # "louveciennes-78350",
        # "magnanville-78354",
        # "magny-les-hameaux-78356",
        # "maisons-laffitte-78358",
        # "mantes-la-jolie-78361",
        # "mantes-la-ville-78362",
        # "marcq-78364",
        # "mareil-le-guyon-78366",
        # "mareil-marly-78367",
        # "mareil-sur-mauldre-78368",
        # "marly-le-roi-78372",
        # "maule-78380",
        # "maulette-78381",
        # "maurecourt-78382",
        # "maurepas-78383",
        # "medan-78384",
        # "menerville-78385",
        # "mere-78389",
        # "mericourt-78391",
        # "meulan-en-yvelines-78401",
        # "mezieres-sur-seine-78402",
        # "mezy-sur-seine-78403",
        # "millemont-78404",
        # "milon-la-chapelle-78406",
        # "mittainville-78407",
        # "moisson-78410",
        # "mondreville-78413",
        # "montainville-78415",
        # "montalet-le-bois-78416",
        # "montchauvet-78417",
        # "montesson-78418",
        # "montfort-l-amaury-78420",
        # "montigny-le-bretonneux-78423",
        # "morainvilliers-78431",
        # "mousseaux-sur-seine-78437",
        # "mulcent-78439",
        # "neauphle-le-chateau-78442",
        # "neauphle-le-vieux-78443",
        # "neauphlette-78444",
        # "nezel-78451",
        # "noisy-le-roi-78455",
        # "notre-dame-de-la-mer-78320",
        # "oinville-sur-montcient-78460",
        # "orcemont-78464",
        # "orgerus-78465",
        # "orgeval-78466",
        # "orphin-78470",
        # "orsonville-78472",
        # "orvilliers-78474",
        # "osmoy-78475",
        # "paray-douaville-78478",
        # "perdreauville-78484",
        # "plaisir-78490",
        # "poigny-la-foret-78497",
        # "poissy-78498",
        # "ponthevrard-78499",
        # "porcheville-78501",
        # "prunay-en-yvelines-78506",
        # "prunay-le-temple-78505",
        # "raizeux-78516",
        # "rambouillet-78517",
        # "rennemoulin-78518",
        # "richebourg-78520",
        # "rochefort-en-yvelines-78522",
        # "rolleboise-78528",
        # "rosay-78530",
        # "rosny-sur-seine-78531",
        # "sailly-78536",
        # "saint-arnoult-en-yvelines-78537",
        # "saint-cyr-l-ecole-78545",
        # "saint-forget-78548",
        # "saint-germain-de-la-grange-78550",
        # "saint-germain-en-laye-78551",
        # "saint-hilarion-78557",
        # "saint-illiers-la-ville-78558",
        # "saint-illiers-le-bois-78559",
        # "saint-lambert-78561",
        # "saint-leger-en-yvelines-78562",
        # "saint-martin-de-brethencourt-78564",
        # "saint-martin-des-champs-78565",
        # "saint-martin-la-garenne-78567",
        # "saint-nom-la-breteche-78571",
        # "saint-remy-l-honore-78576",
        # "saint-remy-les-chevreuse-78575",
        # "sainte-mesme-78569",
        # "sartrouville-78586",
        # "saulx-marchais-78588",
        # "senlisse-78590",
        # "septeuil-78591",
        # "soindres-78597",
        # "sonchamp-78601",
        # "tacoignieres-78605",
        # "tessancourt-sur-aubette-78609",
        # "thiverval-grignon-78615",
        # "thoiry-78616",
        # "tilly-78618",
        # "toussus-le-noble-78620",
        # "trappes-78621",
        # "triel-sur-seine-78624",
        # "vaux-sur-seine-78638",
        # "velizy-villacoublay-78640",
        # "verneuil-sur-seine-78642",
        # "vernouillet-78643",
        # "vert-78647",
        # "vicq-78653",
        # "vieille-eglise-en-yvelines-78655",
        # "villennes-sur-seine-78672",
        # "villepreux-78674",
        # "villette-78677",
        # "villiers-le-mahieu-78681",
        # "villiers-saint-frederic-78683",
        # "viroflay-78686",
        # "voisins-le-bretonneux-78688",
        # "ableiges-95002",
        # "aincourt-95008",
        # "ambleville-95011",
        # "amenucourt-95012",
        # "andilly-95014",
        # "argenteuil-95018",
        # "arnouville-95019",
        # "arronville-95023",
        # "arthies-95024",
        # "asnieres-sur-oise-95026",
        # "attainville-95028",
        # "auvers-sur-oise-95039",
        # "avernes-95040",
        # "baillet-en-france-95042",
        # "banthelu-95046",
        # "beauchamp-95051",
        # "beaumont-sur-oise-95052",
        # "bellefontaine-95055",
        # "belloy-en-france-95056",
        # "bernes-sur-oise-95058",
        # "berville-95059",
        # "bessancourt-95060",
        # "bethemont-la-foret-95061",
        # "bezons-95063",
        # "boisemont-95074",
        # "boissy-l-aillerie-95078",
        # "bonneuil-en-france-95088",
        # "bouffemont-95091",
        # "bouqueval-95094",
        # "bray-et-lu-95101",
        # "breancon-95102",
        # "brignancourt-95110",
        # "bruyeres-sur-oise-95116",
        # "buhy-95119",
        # "butry-sur-oise-95120",
        # "champagne-sur-oise-95134",
        # "charmont-95141",
        # "chars-95142",
        # "chatenay-en-france-95144",
        # "chaumontel-95149",
        # "chaussy-95150",
        # "chauvry-95151",
        # "chennevieres-les-louvres-95154",
        # "cherence-95157",
        # "clery-en-vexin-95166",
        # "commeny-95169",
        # "condecourt-95170",
        # "cormeilles-en-parisis-95176",
        # "cormeilles-en-vexin-95177",
        # "courcelles-sur-viosne-95181",
        # "courdimanche-95183",
        # "deuil-la-barre-95197",
        # "domont-95199",
        # "eaubonne-95203",
        # "ecouen-95205",
        # "enghien-les-bains-95210",
        # "ennery-95211",
        # "epiais-les-louvres-95212",
        # "epiais-rhus-95213",
        # "epinay-champlatreux-95214",
        # "eragny-95218",
        # "ermont-95219",
        # "ezanville-95229",
        # "fontenay-en-parisis-95241",
        # "fosses-95250",
        # "franconville-95252",
        # "fremainville-95253",
        # "fremecourt-95254",
        # "frepillon-95256",
        # "frouville-95258",
        # "garges-les-gonesse-95268",
        # "genainville-95270",
        # "genicourt-95271",
        # "gonesse-95277",
        # "goussainville-95280",
        # "gouzangrez-95282",
        # "grisy-les-platres-95287",
        # "groslay-95288",
        # "guiry-en-vexin-95295",
        # "haravilliers-95298",
        # "haute-isle-95301",
        # "hedouville-95304",
        # "herblay-sur-seine-95306",
        # "herouville-en-vexin-95308",
        # "hodent-95309",
        # "jagny-sous-bois-95316",
        # "jouy-le-moutier-95323",
        # "l-isle-adam-95313",
        # "la-chapelle-en-vexin-95139",
        # "la-frette-sur-seine-95257",
        # "la-roche-guyon-95523",
        # "labbeville-95328",
        # "lassy-95331",
        # "le-bellay-en-vexin-95054",
        # "le-heaulme-95303",
        # "le-mesnil-aubry-95395",
        # "le-perchay-95483",
        # "le-plessis-bouchard-95491",
        # "le-plessis-gassot-95492",
        # "le-plessis-luzarches-95493",
        # "le-thillay-95612",
        # "livilliers-95341",
        # "longuesse-95348",
        # "louvres-95351",
        # "luzarches-95352",
        # "maffliers-95353",
        # "magny-en-vexin-95355",
        # "mareil-en-france-95365",
        # "margency-95369",
        # "marines-95370",
        # "marly-la-ville-95371",
        # "maudetour-en-vexin-95379",
        # "menouville-95387",
        # "menucourt-95388",
        # "meriel-95392",
        # "mery-sur-oise-95394",
        # "moisselles-95409",
        # "montgeroult-95422",
        # "montigny-les-cormeilles-95424",
        # "montlignon-95426",
        # "montmagny-95427",
        # "montmorency-95428",
        # "montreuil-sur-epte-95429",
        # "montsoult-95430",
        # "mours-95436",
        # "moussy-95438",
        # "nerville-la-foret-95445",
        # "nesles-la-vallee-95446",
        # "neuilly-en-vexin-95447",
        # "neuville-sur-oise-95450",
        # "nointel-95452",
        # "noisy-sur-oise-95456",
        # "nucourt-95459",
        # "omerville-95462",
        # "osny-95476",
        # "parmain-95480",
        # "persan-95487",
        # "pierrelaye-95488",
        # "piscop-95489",
        # "pontoise-95500",
        # "presles-95504",
        # "puiseux-en-france-95509",
        # "puiseux-pontoise-95510",
        # "roissy-en-france-95527",
        # "ronquerolles-95529",
        # "sagy-95535",
        # "saint-brice-sous-foret-95539",
        # "saint-clair-sur-epte-95541",
        # "saint-cyr-en-arthies-95543",
        # "saint-gervais-95554",
        # "saint-gratien-95555",
        # "saint-leu-la-foret-95563",
        # "saint-martin-du-tertre-95566",
        # "saint-ouen-l-aumone-95572",
        # "saint-prix-95574",
        # "saint-witz-95580",
        # "sannois-95582",
        # "santeuil-95584",
        # "sarcelles-95585",
        # "seraincourt-95592",
        # "seugy-95594",
        # "soisy-sous-montmorency-95598",
        # "survilliers-95604",
        # "taverny-95607",
        # "themericourt-95610",
        # "theuville-95611",
        # "us-95625",
        # "vallangoujard-95627",
        # "valmondois-95628",
        # "vaudherland-95633",
        # "vaureal-95637",
        # "vemars-95641",
        # "vetheuil-95651",
        # "viarmes-95652",
        # "vienne-en-arthies-95656",
        # "vigny-95658",
        # "villaines-sous-bois-95660",
        # "villeron-95675",
        # "villers-en-arthies-95676",
        # "villiers-adam-95678",
        # "villiers-le-bel-95680",
        # "villiers-le-sec-95682",
        # "wy-dit-joli-village-95690",
    }

    informations_regex: dict[str, str] = {
        "Population 0-14 ans": r"^(?P<result>\d+(,\d+)?%) Population 0-14 ans$",
        "Population 15-29 ans": r"^(?P<result>\d+(,\d+)?%) Population 15-29 ans$",
        "Population 30-44 ans": r"^(?P<result>\d+(,\d+)?%) Population 30-44 ans$",
        "Population 45-59 ans": r"^(?P<result>\d+(,\d+)?%) Population 45-59 ans$",
        "Population 60-74 ans": r"^(?P<result>\d+(,\d+)?%) Population 60-74 ans$",
        "Population 75-89 ans": r"^(?P<result>\d+(,\d+)?%) Population 75-89 ans$",
        "Population 90 ans et +": r"^(?P<result>\d+(,\d+)?%) Population 90 ans et \+$",
        "Sans diplôme": r"^(?P<result>\d+(,\d+)?%) Sans diplôme$",
        "Brevet des collèges": r"^(?P<result>\d+(,\d+)?%) Brevet des collèges$",
        "CAP / BEP": r"^(?P<result>\d+(,\d+)?%) CAP / BEP$",
        "Baccalauréat, brevet professionnel": r"^(?P<result>\d+(,\d+)?%) Baccalauréat, brevet professionnel$",
        "Bac +2 à Bac +4": r"^(?P<result>\d+(,\d+)?%) Bac \+2 à Bac \+4$",
        "Bac +3 ou Bac +4": r"^(?P<result>\d+(,\d+)?%) Bac \+3 ou Bac \+4$",
        "Bac +5 et plus": r"^(?P<result>\d+(,\d+)?%) Bac \+5 et plus$",
        "Couverture en très haut débit": r"^(?P<result>\d+(,\d+)?%) couverture en très haut débit \(fibre\)$",
        "Taux de chômage": r"^(?P<result>\d+(,\d+)?%) Taux de chômage$",
        "Revenu médian": r"^(?P<result>\d+(,\d+)?) € Revenu médian$",
        "Taux de création d'entreprises": r"^(?P<result>\d+(,\d+)?%) Taux de création d'entreprises$",
        "Prix médian au m2 d'un appartement": r"^(?P<result>\d+) € (-|\+)\d+(,\d+)?% Prix médian m2 d'un appartement$",
        "Evolution du prix médian au m2 d'un appartement": r"^\d+ € (?P<result>(-|\+)\d+(,\d+)?%) Prix médian m2 d'un appartement$",
        "Prix médian au m2 d'une maison": r"^(?P<result>\d+) € (-|\+)\d+(,\d+)?% Prix médian m2 d'une maison$",
        "Evolution du prix médian au m2 d'une maison": r"^\d+ € (?P<result>(-|\+)\d+(,\d+)?%) Prix médian m2 d'une maison$",
        "Cambriolages": r"^Cambriolages (?P<result>\d+) \d+$",
        "Vols automobiles": r"^Vols automobiles (?P<result>\d+) \d+$",
        "Vols de particulier": r"^Vols de particulier (?P<result>\d+) \d+$",
        "Violences physiques": r"^Violences physiques (?P<result>\d+) \d+$",
        "Violences sexuelles": r"^Violences sexuelles (?P<result>\d+) \d+$",
        "Médecin": r"^Médecin (?P<result>.*)$",
        "Dentiste": r"^Dentiste (?P<result>.*)$",
        "Infirmier": r"^Infirmier (?P<result>.*)$",
        "Pharmacie": r"^Pharmacie (?P<result>.*)$",
        "Urgences": r"^Urgences (?P<result>.*)$",
        "Crèche": r"^Crèche (?P<result>.*)$",
        "Ecole maternelle": r"^Ecole maternelle (?P<result>.*)$",
        "Ecole élementaire": r"^Ecole élementaire (?P<result>.*)$",
        "Collège": r"^Collège (?P<result>.*)$",
        "Lycée": r"^Lycée (?P<result>.*)$",
        "Hypermarché": r"^Hypermarché (?P<result>.*)$",
        "Supermarché": r"^Supermarché (?P<result>.*)$",
        "Epicerie": r"^Epicerie (?P<result>.*)$",
        "Station service": r"^Station service (?P<result>.*)$",
        "Bureau de Poste": r"^Bureau de Poste (?P<result>.*)$",
        "Hôtel": r"^Hôtel (?P<result>.*)$",
        "Restaurant": r"^Restaurant (?P<result>.*)$",
        "Boulangerie": r"^Boulangerie (?P<result>.*)$",
        "Cinéma": r"^Cinéma (?P<result>.*)$",
        "Bibliothèque": r"^Bibliothèque (?P<result>.*)$",
        "Aeroport": r"^Aeroport .*\((?P<result>\d+(,\d+)?) km\)$",
        "Gare SNCF": r"^Gare SNCF (?P<result>.*)$",
        "Voisin": r"^(?P<result>.* à \d+(,\d+)? km)$",
        "Logements vacants": r"^(?P<result>\d+(,\d+)?%) Logements vacants$",
        "Résidences principales": r"^(?P<result>\d+(,\d+)?%) Résidences principales$",
        "Résidences secondaires": r"^(?P<result>\d+(,\d+)?%) Résidences secondaires$",
        "Propriétaires": r"^(?P<result>\d+(,\d+)?%) Propriétaires$",
        "Locataires": r"^(?P<result>\d+(,\d+)?%) Locataires$",
        "1 pièce": r"^(?P<result>\d+(,\d+)?%) 1 pièce$",
        "2 pièces": r"^(?P<result>\d+(,\d+)?%) 2 pièces$",
        "3 pièces": r"^(?P<result>\d+(,\d+)?%) 3 pièces$",
        "4 pièces": r"^(?P<result>\d+(,\d+)?%) 4 pièces$",
        "5 pièces et plus": r"^(?P<result>\d+(,\d+)?%) 5 pièces et plus$",
        "Crimes et délits": r"^(?P<result>\d+) crimes et délits pour 100 000 habitants.$",
        "Nom": r"^.*\. Le code postal ((de )|(d')|(à ))(?P<result>.+) est \d+\..*$",
        "Code postal": r"^.*\. Le code postal d((e )|').+ est (?P<result>\d+)\..*$",
        "Evolution du nombre d'habitants": r"^(?P<result>-?\d+(,\d+)?%) Entre \d{4} et \d{4}$",
        "Habitants": r"^(?P<result>\d+( \d{3})*) habitants$",
        "Densité": r"^(?P<result>\d+) hab/km2$",
        "Part de maisons": r"^(?P<result>\d+(,\d+)?%) Maisons$",
        "Part d'appartements": r"^(?P<result>\d+(,\d+)?%) Appartements$",
    }
    list_all_infos = []
    for ville in villes:
        informations_formatted = get_informations_from_url(TownInformations(ville).url)
        logging.warning(informations_formatted)
        all_infos: dict[str, str] = {"url": TownInformations(ville).url}
        for name, regex in informations_regex.items():
            informations = get_informations_from_list(informations_formatted, regex)
            for i, info in enumerate(informations):
                suffix: str = ""
                if len(informations) > 1:
                    suffix += " " + str(i)
                all_infos[name + suffix] = info
        list_all_infos += [
            all_infos,
        ]

    pd.DataFrame.from_records(list_all_infos).to_csv(
        "toto.csv", sep=";", decimal=",", encoding="iso8859_15",
    )
